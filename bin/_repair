#!/bin/bash
echo "EasyCKAN Repair"
echo "=============================================="


echo ""
echo "Remove all containers and network"
echo "=============================================="
EASYCKAN_CONTAINERS=$(docker network inspect easyckan | grep -i '"Name": "' | sed 's/"Name": "//g' | sed 's/",//g')
for container in $EASYCKAN_CONTAINERS
do
    docker container rm -f $container
done
echo $EASYCKAN_CONTAINERS
docker network rm easyckan


echo ""
echo "Do all migrations pendents"
echo "=============================================="
easyckan exec paster --plugin=ckan db upgrade --config=/etc/ckan/default/development.ini


echo ""
echo "Rebuild search index"
echo "=============================================="
easyckan exec paster --plugin=ckan search-index rebuild_fast --config=/etc/ckan/default/development.ini